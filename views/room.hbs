<img src="/images/background.jpg" class="background" alt="">
<h1 id="title">Welkom in de Room</h1>
<p id="drawer" style="color:royalblue"></p>
<!--<button onclick='woordCheck(document.getElementById("test1").value.toLowerCase());'>Test</button>-->
<div class="wrapper">
    <div class="leftpanel">
        <div class="paintPanel">
            <div class="box one">
                <div id="canvassize"></div>
                <button id="bigger" onclick="bigger()">++</button>
                <button id="smaller" onclick="smaller()">--</button>
                <button onclick="clearCanvas()">Clear</button>
            </div>
            <div class="box two">
                <div id="black" class="colorSquare"></div>
                <div id="purple" class="colorSquare"></div>
                <div id="blue" class="colorSquare"></div>
                <div id="orange" class="colorSquare"></div>
                <div id="red" class="colorSquare"></div>
                <div id="yellow" class="colorSquare"></div>
                <div id="green" class="colorSquare"></div>
                <div id="eraser" onclick="eraser()"></div>

            </div>

            <!--Hier wordt de canvas getekend d.m.v. javascript-->
            <div id="canvasDiv" class="box three"></div>

        </div>
        <div class="hostPrivileges">
            <!--If player = host-->
            <button class="button" id="startknop">Start</button>
            <button class="button" onclick="setScore()">Kick Player</button>
            <button class="button">Abandon Room</button>
            <!--else-->
            <!--Leave Room-->
        </div>
    </div>
    <div class="rightpanel">
        <div class="scoreboard">
            <p id="output" class="timerpts">Time left: 02:00 Points: 100</p>
            <p id="scores" class="scores">
                player 1: 0 pts <br>
                player 2: 0 pts <br>
                player 3: 0 pts <br>
                player 4: 0 pts
            </p>
        </div>
        <div class="chat_wrapper">
            <div id="chat"></div>
            <form id="chat_form">
                <p><textarea id="message"></textarea> <input type="submit" value="verstuur"/></p>
            </form>
        </div>
        <div id="tekenen">

        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="javascripts/color.js"></script>
<script src="javascripts/canvas.js"></script>
<script src="javascripts/button.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var reset = 0;
    var countdownSec = 120;
    var stop = false;
    var score = 50;
    var scoredisplay = 0;
    var p1 = 0;
    var p2 = 0;
    var p3 = 0;
    var p4 = 0;
    var socket = io.connect('http://localhost:4200');
    var userId;
    var roomId = location.search.split('roomid=')[1];

    $("#startknop").click(function () {
        socket.emit('startGame', roomId);
        stop = false;
    });
    function start() {
        var min = Math.floor(countdownSec / 60);
        var sec = countdownSec % 60;
        if(countdownSec != 0 && !stop) {
            if (reset == 0) {
                setTimeout(function () {
                    countdownSec--;
                    score = (score - 0.4).toFixed(2);
                    scoredisplay = Math.floor(score);
                    socket.emit('tekenen', {room: roomId, x: ArrayX, y: ArrayY, color: ArrayColor, size: ArraySize, dragg: Draggable});
                    start();
                }, 1000);
                document.getElementById("output").innerHTML = "Time left: 0" + min + ":" + sec + "<br> Points: " + scoredisplay;
            } else {
                window.setTimeout(function () {
                    countdownSec = 120;
                    score = 50;
                    scoredisplay = 0;
                    reset = 0;
                    alert("time's up");
                    start();
                }, 5000);
            }
        }
    }
    function setScore() {
        p1 += scoredisplay;
        reset = 1;
        document.getElementById("scores").innerHTML =
                "player 1: " + p1 + " pts <br> player 2: " + p2 + " pts <br> player 3: " + p3 + " pts <br> player 4: " + p4 + " pts ";
    }

    socket.on('connect', function (data) {
        //id van de client
        userId = socket.io.engine.id;
        $("#title").append(" " + userId);
        //room controleren server sided
        socket.emit('joinRoom', {user: userId, room: roomId});
    });
    socket.on('fullRoom', function () {
        location.href = "/roomScreen";
    });
    socket.on('chat', function (data) {
        $("#chat").append(data + "</br>");
        $('#chat').animate({scrollTop: $(document).height() + $('#chat').height()});
    });
    $("#chat_form").submit(function (e) {
        e.preventDefault();
        //de value uit de textarea halen en kijken of er iets in zit
        var message = $("#message").val();
        if (message.length > 0) {
            //chat bericht naar de server sturen
            socket.emit('chatBericht', {message: message, room: roomId, user: userId});
        }
        //textarea weer leeg zetten
        document.getElementById('message').value = "";
    });
    socket.on('tekening', function (data) {
        ArraySize = data.size;
        ArrayY = data.y;
        ArrayX = data.x;
        ArrayColor = data.color;
        Draggable = data.dragg;
        DrawOnCanvas();
    });

    socket.on('startTimer',function (data) {
        stop = false;
        countdownSec = 120;
        score = 50;
        start();
        $('#drawer').html("De tekenaar is: " + data.drawer);
    });

    socket.on('stopTimer', function (data) {
        stop = true;
        if(data.word != "undefined"){
            $("#chat").append("<b style='color:mediumvioletred'>Het woord was: " + data.word + " " + data.user + " was de eerste die het woord goed raadde en heeft " + data.points + " punten gekregen!<b></br>");
        }
    });

    $(window).bind('beforeunload', function () {
        socket.emit('leaveRoom', {user: userId, room: roomId});
    });
</script>